# 現在のプロジェクト状況：土器修復プロジェクト

## 1. 環境
*   **Blender**: 4.2 (起動中)
*   **接続方式**: Model Context Protocol (MCP) `blender-mcp` アドオンを使用。
*   **使用アドオン**: **RBDLab** (破壊シミュレーション用)

## 2. これまでの経緯
### (1) 土器の用意
*   当初「縄文火焔型土器」のスキャンモデルを使用したが、形状が複雑すぎて破壊（Fracture）時にエラー（トゲトゲのノイズ）が多発。
*   解決策として、Blender内で**簡易的な土器（Lathe_Pot）**をスクリプトで生成。
    *   中心軸から回転（Screw）させて作った綺麗な形状。
    *   これにより、RBDLabでの破壊がきれいに成功するようになった。

### (2) 破壊シミュレーション (Fracture)
*   **手法**: RBDLabの `Scatter` (点群配置) -> `Fracture` (ボロノイ分割) を使用。
*   **設定**:
    *   `Scatter`: Standard Scatter (決定ボタンを押して確定済み)。
    *   `Fracture`: Noise 0.05 (ギザギザになりすぎないように調整)。
    *   **物理**: 床（Passive）と破片（Active）を設定し、重力でバラバラになることを確認済み。

### (3) 技術検証 (Feasibility Check)
*   **Check 1: 断面ラベルの取得** (完了)
    *   **結果**: 成功。
    *   **詳細**: `Inner_faces` 属性および `Lathe_Pot_Inner_mat` を使用して断面を特定。青（表面）と赤（断面）の塗り分けに成功（視覚的・データ的に確認済み）。
    *   **意義**: AI学習用のセグメンテーションラベルが正確に生成可能であることが実証された。

*   **Check 2: 隣接関係（正解ペア）の取得** (完了)
    *   **最終手法: 多数決＆平滑化セグメンテーション (V6)** (完了)
    *   **結果**: 大成功。
    *   **詳細**: AI等の助言に基づき、ポリゴンごとの多数決（Majority Vote）と空間平滑化を導入。ノイズによる細切れを抑制しつつ、異なる破片と接する境界のみを正確に分割することに成功。計170個の高品質な断面データを抽出。
    *   **意義**: 完璧な「1対1のマッチング正解」の自動生成が、ノイズのない安定した状態で実現。
    *   **詳細**: フレーム1（割れた瞬間）に戻すことで、「ある破片がどの破片と接していたか」をKDTree（距離計算）で特定できた。
    *   **例**: `Lathe_Pot_cell` は `cell.006`, `cell.023`, `cell.039` とつながっていることが判明。

## 3. 次のステップ：修復システム (Reconstruction)
これから行う作業は、バラバラになった破片を**「元通りに組み立てる（マッチングさせる）」**システムの開発。

### 計画の概要（詳細は `reconstruction_plan.md` 参照）
1.  **断面の特定**:
    *   RBDLabが生成した「断面用マテリアル（Inner Material）」を手がかりに、Pythonスクリプトで破断面を自動検出する。
2.  **特徴抽出**:
    *   検出した断面の「面積」「法線（向き）」「各頂点の位置関係」を計算。
3.  **マッチング**:
    *   全ての破片の中から「ペアになる断面」をプログラムで探索。
4.  **可視化**:
    *   正解のペアを3Dビュー上で線で結ぶ。

## 4. ファイル構成
*   `reconstruction_plan.md`: 今後の詳細な開発計画書。
*   このフォルダ (`VibeCording`) : 今後の作業場所。

---
**次のチャットでの指示出し例:**
> 「VibeCordingフォルダにある現状確認ファイルを見て、続きから始めて」
> 「まずは計画通り、断面を認識するPythonスクリプトを書いてみて」
